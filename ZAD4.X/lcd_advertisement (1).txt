#pragma config POSCMOD = XT         
#pragma config OSCIOFNC = ON        
#pragma config FCKSM = CSDCMD       
#pragma config FNOSC = PRI          
#pragma config IESO = ON

#pragma config WDTPS = PS32768     
#pragma config FWPSA = PR128        
#pragma config WINDIS = ON          
#pragma config FWDTEN = OFF         
#pragma config ICS = PGx2           
#pragma config GWRP = OFF           
#pragma config GCP = OFF            
#pragma config JTAGEN = OFF

#include <xc.h>     
#include <libpic30.h>
#include <stdbool.h>
#include <string.h>
#include "lcd.h"

#define FCY 4000000UL

void czekaj(unsigned int ms) {
    unsigned int i, j;
    for(i = 0; i < ms; i++) {
        for(j = 0; j < 1000; j++) {
            Nop();
        }
    }
}

void wyswietl_z_przewijaniem(const char* tekst_gora, const char* tekst_dol, unsigned int szybkosc, unsigned int cykle) {
    char bufor_dol[17];
    int rozmiar_dol = strlen(tekst_dol);
    int pozycja;
    unsigned int i;
    
    // Dodaj spacje na początku tekstu dolnego dla płynnego przewijania
    char tekst_z_spacjami[200];
    strcpy(tekst_z_spacjami, "                "); // 16 spacji
    strcat(tekst_z_spacjami, tekst_dol);
    strcat(tekst_z_spacjami, "                "); // 16 spacji na końcu
    int pelny_rozmiar = strlen(tekst_z_spacjami);
    
    for(i = 0; i < cykle; i++) {
        for (pozycja = 0; pozycja <= pelny_rozmiar - 16; pozycja++) {
            LCD_ClearScreen();
            
            // Wyświetl statyczny tekst na górze
            LCD_PutString((char*)tekst_gora, strlen(tekst_gora));
            
            // Przejdź do drugiej linii
            LCD_PutChar('\n');
            
            // Przygotuj bufor dla przewijanego tekstu (od prawej do lewej)
            int j;
            for (j = 0; j < 16; j++) {
                if (pozycja + j < pelny_rozmiar) {
                    bufor_dol[j] = tekst_z_spacjami[pozycja + j];
                } else {
                    bufor_dol[j] = ' ';
                }
            }
            bufor_dol[16] = '\0';
            
            // Wyświetl przewijany tekst na dole
            LCD_PutString(bufor_dol, 16);
            
            czekaj(szybkosc);
        }
    }
}

void wyswietlanie1(void) {
    wyswietl_z_przewijaniem("RASHED KEBAB!", "KEBAB TYLKO 15 ZLOTYCH! SWIEZE MIESO!", 200, 2);
}

void wyswietlanie2(void) {
    wyswietl_z_przewijaniem(">> PROMOCJA <<", "KEBAB+COLA 20ZL - ul. Kowalskiego obok Biedronki", 180, 2);
}

void wyswietlanie3(void) {
    wyswietl_z_przewijaniem("CZYNNE 10-3", "ZAMOW: 123-456-789 - DOSTAWA GRATIS!", 220, 2);
}

int main(void) {
    unsigned int i;
    for(i = 0; i < 10000; i++) {
        Nop();
    }
    
    LCD_Initialize();
    LCD_CursorEnable(false);       
    
    while (1) {
        wyswietlanie1();
        wyswietlanie2();
        wyswietlanie3();
        LCD_ClearScreen();
        czekaj(1000);
    }
    
    return 0;
}